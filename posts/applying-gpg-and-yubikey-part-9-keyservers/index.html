<!doctype html><html lang=en><head><title>Applying GPG and Yubikey: Part 9 (Keyservers) · Chip Senkbeil</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Chip Senkbeil"><meta name=description content="

Traditional Keyservers


Discuss keyservers, cite some examples, and how to use them




Keybase


Discuss keybase and how to use it




Revoking my GPG key


Mention old process of making unique subkey for each YubiKey Mention process of
revoking




Conclusion


TODO… what should be put here?

What is it?

Why did I need it?

What did I do?

Conclusion

When adding new keys at the same time to GPG (recipients) or passwordstore, I
needed to add an exclamation mark to the end. E.g. 0xDEADBEEF! in order to force
encryption with that key and allow multiple keys as options."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Applying GPG and Yubikey: Part 9 (Keyservers)"><meta name=twitter:description content="Traditional Keyservers Discuss keyservers, cite some examples, and how to use them
Keybase Discuss keybase and how to use it
Revoking my GPG key Mention old process of making unique subkey for each YubiKey Mention process of revoking
Conclusion TODO… what should be put here?
What is it?
Why did I need it?
What did I do?
Conclusion
When adding new keys at the same time to GPG (recipients) or passwordstore, I needed to add an exclamation mark to the end. E.g. 0xDEADBEEF! in order to force encryption with that key and allow multiple keys as options."><meta property="og:url" content="https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-9-keyservers/"><meta property="og:site_name" content="Chip Senkbeil"><meta property="og:title" content="Applying GPG and Yubikey: Part 9 (Keyservers)"><meta property="og:description" content="Traditional Keyservers Discuss keyservers, cite some examples, and how to use them
Keybase Discuss keybase and how to use it
Revoking my GPG key Mention old process of making unique subkey for each YubiKey Mention process of revoking
Conclusion TODO… what should be put here?
What is it?
Why did I need it?
What did I do?
Conclusion
When adding new keys at the same time to GPG (recipients) or passwordstore, I needed to add an exclamation mark to the end. E.g. 0xDEADBEEF! in order to force encryption with that key and allow multiple keys as options."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-26T00:00:00-05:00"><meta property="article:modified_time" content="2019-08-26T00:00:00-05:00"><meta property="article:tag" content="Gpg"><meta property="article:tag" content="Yubikey"><link rel=canonical href=https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-9-keyservers/><link rel=preload href=https://chipsenkbeil.com/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://chipsenkbeil.com/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://chipsenkbeil.com/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://chipsenkbeil.com/css/coder.min.2cd2ba040eaadea1390f8199e24bd994fabd69b5a7034b43fc2440c58fd09808.css integrity="sha256-LNK6BA6q3qE5D4GZ4kvZlPq9abWnA0tD/CRAxY/QmAg=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://chipsenkbeil.com/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=https://chipsenkbeil.com/images/favicon.svg sizes=any><link rel=icon type=image/png href=https://chipsenkbeil.com/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://chipsenkbeil.com/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://chipsenkbeil.com/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://chipsenkbeil.com/images/apple-touch-icon.png><link rel=manifest href=https://chipsenkbeil.com/site.webmanifest><link rel=mask-icon href=https://chipsenkbeil.com/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://chipsenkbeil.com/>Chip Senkbeil
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/notes/>notes</a></li><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/miscellaneous/>miscellaneous</a></li><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/about/>about</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-9-keyservers/>Applying GPG and Yubikey: Part 9 (Keyservers)</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-08-26T00:00:00-05:00>August 26, 2019
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
6-minute read</span></div><div class=categories><i class="fa-solid fa-folder" aria-hidden=true></i>
<a href=https://chipsenkbeil.com/categories/applying/>Applying</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://chipsenkbeil.com/tags/gpg/>Gpg</a>
</span><span class=separator>•</span>
<span class=tag><a href=https://chipsenkbeil.com/tags/yubikey/>Yubikey</a></span></div></div></header><div class=post-content><div id=outline-container-headline-1 class=outline-4><h4 id=headline-1>Traditional Keyservers</h4><div id=outline-text-headline-1 class=outline-text-4><p>Discuss keyservers, cite some examples, and how to use them</p></div></div><div id=outline-container-headline-2 class=outline-4><h4 id=headline-2>Keybase</h4><div id=outline-text-headline-2 class=outline-text-4><p>Discuss keybase and how to use it</p></div></div><div id=outline-container-headline-3 class=outline-4><h4 id=headline-3>Revoking my GPG key</h4><div id=outline-text-headline-3 class=outline-text-4><p>Mention old process of making unique subkey for each YubiKey Mention process of
revoking</p></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Conclusion</h3><div id=outline-text-headline-4 class=outline-text-3><p>TODO… what should be put here?</p><p>What is it?</p><p>Why did I need it?</p><p>What did I do?</p><p>Conclusion</p><p>When adding new keys at the same time to GPG (recipients) or passwordstore, I
needed to add an exclamation mark to the end. E.g. 0xDEADBEEF! in order to force
encryption with that key and allow multiple keys as options.</p><p>See
<a href=https://security.stackexchange.com/questions/181551/create-backup-yubikey-with-identical-pgp-keys>https://security.stackexchange.com/questions/181551/create-backup-yubikey-with-identical-pgp-keys</a>
for details. I may have a different approach using a SINGLE set of subkeys and
duplicating if I can get it to have a different card id on each machine.</p><p>NOTE: Originally, I was using manual subkey IDs to encrypt. With pass, if you
provide the email address for the key containing the subkeys (for me
chip@senkbeil.org), then pass will pull all of the encryption subkeys to use for
you. Need to test if the exclamation mark is still needed.</p><p>Need to provide the option –limit-card-insert-tries=1 to disable the dialog to
insert a key. Ideally, I already have the key I need, and it's REALLY annoying
when I have different encryption keys on multiple smartcards and I get multiple
prompts to insert a smart card. So far, this option isn't working like
indicated. I'm only 2.0.10 and the latest is 2.0.15, so wondering if a bug.</p><p>NOTE: Turns out the functionality was removed (by accident?) and I've written a
note about it in my gpg.conf. Should get a patch out to fix it for gpg.</p><p>When getting issue about invalid ID and no secret key when decrypting from GPG
on Yubikey (even though encrypt worked), it was because I had a single key with
SEC (sign, encrypt/decrypt, auth). See
<a href="https://marc.info/?l=gnupg-users&amp;m=155057187801474&amp;w=2">https://marc.info/?l=gnupg-users&amp;m=155057187801474&amp;w=2</a> for details, but just
creating a subkey dedicated to encrypt/decrypt fixed that issue.</p><p>On Android phone, needed to go to Settings > Connections > NFC to enable it.</p><p>When using my keys on new computers, I still need to import my public keys. They
are hosted on keybase.io, ubuntu server, and more.</p><pre class=example>
curl https://keybase.io/senkwich/pgp_keys.asc | gpg --import
</pre><p>Can add url to Yubikeys to auto pull the public key? Yes, but easier with
command instead of needing to do <code class=verbatim>gpg --edit-card</code> followed by <code class=verbatim>fetch</code></p><p>For signing, currently using <code class=verbatim>chip@senkbeil.org</code>, which I believe will default
to the most recently used subkey, but not sure. So far, it seems to be working.
I did notice a warning about trust on other laptops that didn't originate the
private master key. They show the key as <code class=verbatim>[unknown]</code> instead of <code class=verbatim>[ultimate]</code> for
trust level. Need to go in and do <code class=verbatim>gpg --edit-card</code> followed by <code class=verbatim>trust</code> and
select level 5 (full trust) since this is my own key.</p><p>NOTE: Not selecting most recently used subkey.</p></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Updating keyring to indicate most subkeys are offline</h3><div id=outline-text-headline-5 class=outline-text-3><p>My keyring on the laptop that I've been using to make subkeys for yubikey</p><pre class=example>
sec#  rsa4096/0x6CA6A08DBA640677 2019-03-01 [SC]
      2C8160E6AF1166154CDAED266CA6A08DBA640677
uid                   [ultimate] Chip Senkbeil (My mail &amp; pass key) &lt;chip@senkbeil.org&gt;
ssb&gt;  rsa4096/0x588B4B090695884C 2019-03-01 [E]
ssb&gt;  rsa4096/0x8A6B3DB2C23EB74B 2019-05-08 [E]
ssb&gt;  rsa4096/0x95B67753BA414327 2019-05-08 [E]
ssb&gt;  rsa4096/0x231C4CB425985243 2019-05-28 [S] [expires: 2024-05-26]
ssb&gt;  rsa4096/0x1F3D585E398D11B1 2019-05-28 [S] [expires: 2024-05-26]
ssb&gt;  rsa4096/0x5487424ABA6BDDDB 2019-05-28 [S] [expires: 2024-05-26]
ssb&gt;  rsa4096/0x68F5987A509841B2 2019-05-28 [A] [expires: 2024-05-26]
ssb&gt;  rsa4096/0x70B8AA34DA9D2413 2019-05-28 [A] [expires: 2024-05-26]
ssb&gt;  rsa4096/0xDD69ABE5B8BCF75C 2019-05-28 [A] [expires: 2024-05-26]
ssb&gt;  rsa4096/0xD2A7E4F93EE05063 2019-06-01 [E]
ssb&gt;  rsa4096/0xBD37FFFCCF094200 2019-06-01 [E]
ssb&gt;  rsa4096/0xA8A1328E9E32C17D 2019-06-01 [S] [expires: 2024-05-30]
ssb&gt;  rsa4096/0x7C55D59BE4B5A22F 2019-06-01 [S] [expires: 2024-05-30]
ssb&gt;  rsa4096/0xD34B040C5D45D107 2019-06-01 [A] [expires: 2024-05-30]
ssb&gt;  rsa4096/0x27ACC8B2AA43159B 2019-06-01 [A] [expires: 2024-05-30]
</pre><p><code class=verbatim>#</code> pound sign means that the key is offline (unavailable). I removed my master
key from the machine using <code class=verbatim>gpg-connect-agent "DELETE_KEY &lt;KEYGRIP>"</code> followed
by <code class=verbatim>/bye</code> to exit.</p><p>Got keygrips using <code class=verbatim>gpg2 --list-secret-keys --with-keygrip</code></p><p>Thought is that gpg is picking the wrong subkey because it think all of them are
available right now. I only want it to think a specific subkey is available. To
do that, need to go through and mark the stubs as offline. Before, when all were
offline, inserting a smart card and using <code class=verbatim>gpg --card-status</code> refreshed and
changed <code class=verbatim>#</code> to <code class=verbatim>></code>.</p><p>Deleting a stub using <code class=verbatim>DELETE_KEY &lt;KEYGRIP></code> and then refreshing with
<code class=verbatim>gpg --card-status</code> does indeed return <code class=verbatim>#</code> to <code class=verbatim>></code>.</p><p>Annoyance is that doing <code class=verbatim>gpg-connect-agent "DELETE_KEY &lt;KEYGRIP> /bye"</code> still
leaves us in the gpg-connect-agent mode until we hit enter. How to leave? Turns
out, need to do the bye logic outside via
<code class=verbatim>gpg-connect-agent "DELETE_KEY &lt;KEYGRIP>" /bye</code></p><p>Can use <code class=verbatim>gpg --list-secret-keys --with-keygrip "fingerprint"</code> to only get
keygrips for my specific key.</p><p>NOTE: Making all keys offline except for subkey that is available fixes signing
problem, but for some reason does not fix encryption. Still need exclamation
mark on all recipients for pass tool.</p></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Using auth key with github.com</h3><div id=outline-text-headline-6 class=outline-text-3><p>Based on <a href=https://opensource.com/article/19/4/gpg-subkeys-ssh>this article</a>
from April 2019, need to make ssh aware of gpg auth keys.</p><p>Get the keygrips of auth keys via <code class=verbatim>gpg -K --with-keygrip</code> and place into
<code class=verbatim>$HOME/.gnupg/sshcontrol</code>.</p><p>Make sure that gpg-agent is configured with ssh by adding <code class=verbatim>enable-ssh-support</code>
to <code class=verbatim>$HOME/.gnupg/gpg-agent.conf</code> and restarting the agent via
<code class=verbatim>gpgconf --kill all</code>. Can manually launch via <code class=verbatim>gpgconf --launch gpg-agent</code> if
needed.</p><p>Add this export to <code class=verbatim>.bashrc</code> or <code class=verbatim>.zshrc</code>:</p><pre class=example>
export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
</pre><p>Get ssh-rsa public key to provide to github via <code class=verbatim>ssh-add -L</code>. The above resolved
the "no identity" issue I was encountering earlier.</p><p>I had two keys show up, one with my card number for the yubikey and one listed
as none. I had added all five of my auth keys (one per yubikey) to the
sshcontrol file. I only added the key that had the card number to github and it
worked fine.</p><div id=outline-container-headline-7 class=outline-4><h4 id=headline-7>Using auth key for ssh to remote machines</h4><div id=outline-text-headline-7 class=outline-text-4><p>Follow the setup for github to get ssh to detect auth keys.</p><p>Copy entire output from <code class=verbatim>ssh-add -L</code> to remote machine's
<code class=verbatim>$HOME/.ssh/authorized_keys</code> file, or alternatively use
<code class=verbatim>ssh-copy-id &lt;username>@&lt;server></code> to smart copy the keys over that do not yet
exist.</p><p>After that, sshing into the machine works just fine for me.</p></div></div><div id=outline-container-headline-8 class=outline-4><h4 id=headline-8>Revoking keys</h4><div id=outline-text-headline-8 class=outline-text-4><p>Can have a revoke cert, or if using subkeys can revoke using master key, which
is what I did for old approach.</p><p>When others pull public keys for you and list (or you list private keys), the
revoked keys will not be shown (less noise).</p><p>Revoked keys will be shown when doing <code class=verbatim>gpg --edit-key &lt;KEY></code>, which is annoying.
Can delete keys from keyring for them to not be shown, but pulling down keys
from keyserver will make them appear again.</p></div></div><div id=outline-container-headline-9 class=outline-4><h4 id=headline-9>neomutt & notmuch</h4><div id=outline-text-headline-9 class=outline-text-4><p>Can self encrypt to read sent mail for neomutt</p><p>Need to determine settings for neomutt to encrypt. We don't want to
auto-encrypt, do we? Things like gmail and outlook will struggle.</p><p>notmuch can use gpg keys to decrypt if index.decrypt set to nostash or true.
Default is auto, which only uses stashed session keys.</p><p>Given we have our key stored in a yubikey and password protected, fine with
nostash.</p></div></div></div></div></div><footer></footer></article></section></div><footer class=footer><div class=container><p>©
2012 -
2025
Chip Senkbeil<br>Views are my own (<a href=https://chipsenkbeil.com/keys/chipsenkbeil.pub.gpg>Public Keys</a>)</p></div></footer></main></body></html>