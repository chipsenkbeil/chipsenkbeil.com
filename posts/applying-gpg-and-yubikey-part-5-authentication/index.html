<!doctype html><html lang=en><head><title>Applying GPG and Yubikey: Part 5 (Authentication) · Chip Senkbeil</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Chip Senkbeil"><meta name=description content="As a reminder, you can check out my overview
post if you&rsquo;re curious about
why and in what ways I started using GPG and Yubikey. If you haven&rsquo;t set up
your GPG keys yet, I also talk about a simple flow in my second
post.
Today, we&rsquo;re going specifically into using GPG for authentication for SSHing
into remote servers and associating with Github.

  Using my GPG key for authenticating over SSH
  
    
    Link to heading
  

One handy use case for GPG keys related to authentication is using a GPG key to
access remote servers over SSH. Rather than using password-based authentication
or SSH public key authentication via ssh-keygen, we can leverage a GPG key
with authentication capabilities to connect instead."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Applying GPG and Yubikey: Part 5 (Authentication)"><meta name=twitter:description content="As a reminder, you can check out my overview post if you’re curious about why and in what ways I started using GPG and Yubikey. If you haven’t set up your GPG keys yet, I also talk about a simple flow in my second post.
Today, we’re going specifically into using GPG for authentication for SSHing into remote servers and associating with Github.
Using my GPG key for authenticating over SSH Link to heading One handy use case for GPG keys related to authentication is using a GPG key to access remote servers over SSH. Rather than using password-based authentication or SSH public key authentication via ssh-keygen, we can leverage a GPG key with authentication capabilities to connect instead."><meta property="og:url" content="https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-5-authentication/"><meta property="og:site_name" content="Chip Senkbeil"><meta property="og:title" content="Applying GPG and Yubikey: Part 5 (Authentication)"><meta property="og:description" content="As a reminder, you can check out my overview post if you’re curious about why and in what ways I started using GPG and Yubikey. If you haven’t set up your GPG keys yet, I also talk about a simple flow in my second post.
Today, we’re going specifically into using GPG for authentication for SSHing into remote servers and associating with Github.
Using my GPG key for authenticating over SSH Link to heading One handy use case for GPG keys related to authentication is using a GPG key to access remote servers over SSH. Rather than using password-based authentication or SSH public key authentication via ssh-keygen, we can leverage a GPG key with authentication capabilities to connect instead."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-06T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-06T00:00:00+00:00"><meta property="article:tag" content="Gpg"><meta property="article:tag" content="Yubikey"><link rel=canonical href=https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-5-authentication/><link rel=preload href=https://chipsenkbeil.com/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://chipsenkbeil.com/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://chipsenkbeil.com/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://chipsenkbeil.com/css/coder.min.2cd2ba040eaadea1390f8199e24bd994fabd69b5a7034b43fc2440c58fd09808.css integrity="sha256-LNK6BA6q3qE5D4GZ4kvZlPq9abWnA0tD/CRAxY/QmAg=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://chipsenkbeil.com/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=https://chipsenkbeil.com/images/favicon.svg sizes=any><link rel=icon type=image/png href=https://chipsenkbeil.com/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://chipsenkbeil.com/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=https://chipsenkbeil.com/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://chipsenkbeil.com/images/apple-touch-icon.png><link rel=manifest href=https://chipsenkbeil.com/site.webmanifest><link rel=mask-icon href=https://chipsenkbeil.com/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://chipsenkbeil.com/>Chip Senkbeil
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/notes/>notes</a></li><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/miscellaneous/>miscellaneous</a></li><li class=navigation-item><a class=navigation-link href=https://chipsenkbeil.com/about/>about</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-5-authentication/>Applying GPG and Yubikey: Part 5 (Authentication)</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2019-10-06T00:00:00Z>October 6, 2019
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
3-minute read</span></div><div class=categories><i class="fa-solid fa-folder" aria-hidden=true></i>
<a href=https://chipsenkbeil.com/categories/applying/>Applying</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=https://chipsenkbeil.com/tags/gpg/>Gpg</a>
</span><span class=separator>•</span>
<span class=tag><a href=https://chipsenkbeil.com/tags/yubikey/>Yubikey</a></span></div></div></header><div class=post-content><p>As a reminder, you can check out my <a href=https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-1-overview>overview
post</a> if you&rsquo;re curious about
why and in what ways I started using GPG and Yubikey. If you haven&rsquo;t set up
your GPG keys yet, I also talk about a simple flow <a href=https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-2-setup>in my second
post</a>.</p><p>Today, we&rsquo;re going specifically into using GPG for authentication for SSHing
into remote servers and associating with Github.</p><h3 id=using-my-gpg-key-for-authenticating-over-ssh>Using my GPG key for authenticating over SSH
<a class=heading-link href=#using-my-gpg-key-for-authenticating-over-ssh><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p>One handy use case for GPG keys related to authentication is using a GPG key to
access remote servers over SSH. Rather than using password-based authentication
or SSH public key authentication via <code>ssh-keygen</code>, we can leverage a GPG key
with authentication capabilities to connect instead.</p><p>The prerequisite is that we need a GPG key with authentication capabilities.
Make sure that you have one by checking your keys and capabilities via <code>gpg -k</code>:</p><p><img src=https://chipsenkbeil.com/img/post/keys/gpg-keys-list.png alt="Output of gpg -k showing keys"></p><p>I&rsquo;ve personally switched over my home servers to only allow public key
authentication over SSH and am leveraging my GPG auth subkey rather than the
traditional <a href=https://www.ssh.com/ssh/key/ class=external-link target=_blank rel=noopener>SSH key</a> because it enables me to
only manage a single key and I can store my GPG key on external hardware like a
Yubikey in the same manner as my encryption and signing keys.</p><p>There are a couple of requirements to plug in a GPG auth key for use via SSH:</p><ol><li>Add the keygrip of the auth key to <strong>$HOME/.gnupg/sshcontrol</strong></li><li>Enable SSH support for the GPG agent</li><li>Export the SSH auth socket from the GPG agent</li><li>Copy over the ssh-rsa contents of the GPG auth key to the remote server(s)</li></ol><h4 id=more-details>More Details
<a class=heading-link href=#more-details><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h4><p>Based on <a href=https://opensource.com/article/19/4/gpg-subkeys-ssh class=external-link target=_blank rel=noopener>this article</a>
from April 2019, we need to make ssh aware of GPG auth keys.</p><p>As mentioned, the first step is to get the keygrips of auth keys via <code>gpg -K --with-keygrip</code> and place them into <strong>$HOME/.gnupg/sshcontrol</strong>.</p><p>From there, the second step is to make sure that <strong>gpg-agent</strong> is configured
with ssh by adding <code>enable-ssh-support</code> to <strong>$HOME/.gnupg/gpg-agent.conf</strong> and
restarting the agent via <code>gpgconf --kill all</code>. We can also manually launch the
GPG agent via <code>gpgconf --launch gpg-agent</code> if needed.</p><p>The third step is to set <strong>SSH_AUTH_SOCK</strong> to the GPG agent&rsquo;s SSH socket, which
can be done by adding the following export to our Bash - <strong>$HOME/.bashrc</strong> - or
Zsh - <strong>$HOME/.zshrc</strong> - config:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=k>export</span> <span class=n>SSH_AUTH_SOCK</span><span class=o>=$</span><span class=p>(</span><span class=n>gpgconf</span> <span class=o>--</span><span class=n>list</span><span class=o>-</span><span class=n>dirs</span> <span class=n>agent</span><span class=o>-</span><span class=n>ssh</span><span class=o>-</span><span class=n>socket</span><span class=p>)</span>
</span></span></code></pre></div><p>Lastly, the fourth and final step is to add an <strong>ssh-rsa</strong> public key to the
remote server(s) where we want to use our GPG auth key to connect. This makes
them aware of valid keys to accept incoming requests. We can get the key via
<code>ssh-add -L</code>, which should output one or more <strong>ssh-rsa</strong> public keys based on
our GPG auth key if the agent has been configured correctly and we have
exported <strong>SSH_AUTH_SOCK</strong>.</p><p>Copy entire output from <code>ssh-add -L</code> to each remote machine&rsquo;s
<strong>$HOME/.ssh/authorized_keys</strong> file, or alternatively use <code>ssh-copy-id &lt;username>@&lt;server></code> to smart copy the keys over that do not yet exist.</p><blockquote><p>I had two keys show up, one with my card number for the yubikey and one
listed as none. I only added the key that had the card number to my remote
servers and it worked fine.</p></blockquote><h3 id=connecting-my-gpg-auth-key-with-github-for-ssh>Connecting my GPG auth key with Github for SSH
<a class=heading-link href=#connecting-my-gpg-auth-key-with-github-for-ssh><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><p><img src=https://chipsenkbeil.com/img/post/keys/github-keys.png alt="Github SSH & GPG keys"></p><p>Adding support for Github authentication is very similar to the steps listed
for a remote server that you own with the distinction that we need to copy the
output of <code>ssh-add -L</code> to a textbox on Github&rsquo;s website when adding a new SSH
key (our GPG auth key).</p><p><img src=https://chipsenkbeil.com/img/post/keys/github-add-ssh-key.png alt="Adding a new SSH key on Github"></p><h2 id=whats-next>What&rsquo;s next?
<a class=heading-link href=#whats-next><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In <a href=https://chipsenkbeil.com/posts/applying-gpg-and-yubikey-part-6-setting-up-yubikeys>the next post</a>, I&rsquo;ll be explaining how configure a Yubikey to host GPG subkeys for encryption, signing, and authentication as well as my process to maintain a single set of keys across multiple Yubikeys for different computers and other devices.</p></div><footer></footer></article></section></div><footer class=footer><div class=container><p>©
2012 -
2025
Chip Senkbeil<br>Views are my own (<a href=https://chipsenkbeil.com/keys/chipsenkbeil.pub.gpg>Public Keys</a>)</p></div></footer></main></body></html>